<%- include('../partials/header') %>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-secondary">Admin Dashboard</h2>
        <div>
            <a href="/admin/subject/add" class="btn btn-primary">+ Add New Subject</a>
        </div>
    </div>
    
    <!-- Registration Toggle Card -->
    <div class="card mb-4 border-warning">
        <div class="card-body d-flex justify-content-between align-items-center bg-light">
            <div>
                <h5 class="card-title">User Registration</h5>
                <p class="card-text small text-muted">Currently: <strong class="<%= currentUser.isRegistrationEnabled ? 'text-success' : 'text-danger' %>"><%= currentUser.isRegistrationEnabled ? 'Enabled' : 'Disabled' %></strong></p>
            </div>
            <form action="/admin/toggle-registration" method="POST">
                <button class="btn <%= currentUser.isRegistrationEnabled ? 'btn-danger' : 'btn-success' %>">
                    <%= currentUser.isRegistrationEnabled ? 'Disable Registration' : 'Enable Registration' %>
                </button>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white fw-bold">Manage Subjects</div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% subjects.forEach(subject => { %>
                                <tr>
                                    <td><a href="/subject/<%= subject._id %>"><%= subject.name %></a></td>
                                    <td><%= subject.description %></td>
                                    <td class="text-end">
                                        <a href="/subject/<%= subject._id %>" class="btn btn-sm btn-info text-white me-1">View/Add Topics</a>
                                        <form action="/admin/subject/<%= subject._id %>?_method=DELETE" method="POST" class="d-inline" onsubmit="return confirm('Delete this Subject and ALL its topics?')">
                                            <button class="btn btn-sm btn-danger">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                            <% }) %>
                            <% if (subjects.length === 0) { %>
                                <tr>
                                    <td colspan="3" class="text-center py-4">No subjects found.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
<%- include('../partials/footer') %>
